#!/usr/bin/env node

var glob = require('glob').sync;
var path = require('path');
var spawn = require('child_process').spawn;

function findPeonsFile(folder) {
  if (glob('peonsfile.+(js|coffee)', {nocase: true, cwd: folder}).length) {
    return folder;
  }

  var parent = path.resolve(folder, '../');

  if (parent === folder) {
    return false;
  }

  return findPeonsFile(parent);
}

var projectDir = findPeonsFile(process.cwd());
var gruntBin = path.join(__dirname, '../node_modules/.bin/grunt');

if (!projectDir) {
  console.error(new Error('could not find a peonsfile'));
  return;
}

process.argv.splice(0, 2);

spawn(
  gruntBin,
  [
    '--gruntfile',
    path.join(__dirname, '../mainpeons.js'),
    '--projectDir',
    projectDir
  ].concat(process.argv),
  {
    stdio: 'inherit'
  }
);
